# Triton Inference Server의 파이프라인 오버헤드 줄이기

기본적으로 CPU와 GPU는 연산하는 "위치"가 다릅니다. CPU는 메인보드 대략 중앙에 있는 거대한 쿨러 속에 숨어있고, GPU는 그 아래에 요즘따라 점점 거대해지고 있는 쇳덩어리가 바로 그것이죠. 그리고 그것을 연결해주는 것이 PCIe 버스가 있습니다. 이 PCIe 버스에 CPU의 데이터와 GPU의 데이터가 오가죠.

많은 사람들이 간과하는 중요한 부분이 바로 이 PCIe 버스를 통한 데이터 전송입니다. 예시를 들어볼까요? 저희가 인천에서 모란으로 이사를 간다고 생각해봅시다. 이사를 가려면, 인천 집에 있는 물건들을 모란 집으로 옮겨야 합니다. 이럴 때 대부분 트럭을 사용하거나, 그에 준하는 큰 차를 이용합니다.

이제 인천 집은 CPU, 모란 집은 GPU, 트럭은 PCIe 버스로 생각봅시다.

- 트럭의 크기 (대역폭): 트럭이 클수록 한 번에 많은 물건을 옮길 수 있습니다. 일반적으로 저희는 왕복 이동을 최소화하기 위해 짐을 최대한 많이 실으려고 합니다. 작은 트럭을 여러 번 왕복시키는 것보다 큰 트럭 한 대가 한 번만 가는 것이 효율적이니까요. PCIe 버스의 대역폭도 마찬가지입니다. 높은 대역폭을 가진 버스는 더 많은 데이터를 효율적이고 빠르게 전송할 수 있습니다.

- 트럭의 속도 (지연 시간): 트럭이 빠를수록 물건을 빨리 옮길 수 있습니다. 하지만 트럭은 대부분의 차량보다 빠르지 않습니다. 단지 트럭은 많은 짐을 한꺼번에 옮길 수 있습니다. 그러므로 트럭이 출발하고 도착하는 데에도 꽤 시간이 걸립니다. PCIe 버스도 이와 비슷하게, 데이터의 전송 시작과 종료 사이에는 이러한 지연 시간이 발생합니다.

- 짐을 싣고 내리는 과정 (오버헤드): 트럭에 물건을 싣거나 내리는 데에도 시간이 걸립니다. 마찬가지로, CPU와 GPU간의 데이터를 복사할 때도 추가적인 시간이 필요합니다. (CPU와 GPU간의 데이터 전송은 move가 아닌 copy입니다.)

데이터를 CPU에서 GPU로 전송하는 것은 단순히 '데이터 이동'과는 다릅니다. 이를 이사와 비교하면, 짐을 다른 집으로 옮기는 것이 짐이 자동으로 뚝 떨어지는게 아닌 것과 같습니다. 최종적으로는 데이터의 양, 전송 빈도, 그리고 필요한 전송 시간을 모두 고려하여야만 최적의 성능을 달성할 수 있습니다. 그러므로, CPU와 GPU 사이에서의 데이터 이동 최적화는 성능 향상의 핵심 요소입니다.
